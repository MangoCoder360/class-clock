<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CC Community Themes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,700,0,0" />
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa&family=Seaweed+Script&family=Permanent+Marker&family=Roboto:wght@100&display=swap" rel="stylesheet">
</head>
<nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
      <a class="navbar-brand" href="/">Class Clock</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#">Community Themes</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" aria-current="page" data-bs-toggle="modal" data-bs-target="#submitTheme">Submit a Theme</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" aria-current="page" data-bs-toggle="modal" data-bs-target="#rules">Rules</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" aria-current="page" data-bs-toggle="modal" data-bs-target="#adminLogin">Admin Login</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="https://docs.google.com/forms/d/e/1FAIpQLSch720hqOH3I21o_LJ0by5quzKJJzitWrUCRC8_CP9SFn3Xsg/viewform?usp=sf_link">Report a Theme</a>
              </li>
        </ul>
      </div>
    </div>
  </nav>
<body>
  <div id="loading">
    <div class="lds-roller"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
  </div>
  <div class="row" id="card-container"></div>
</body>
<div class="modal fade" id="installingTheme" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="installingThemeLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="installingThemeLabel">Installing Theme...</h1>
        </div>
        <div class="modal-body">
          <div class="progress" role="progressbar" aria-label="installProgress" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 0%"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="submitTheme" tabindex="-1" aria-labelledby="submitThemeLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="submitThemeLabel">Submit a Theme</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-header">
          <h1 class="modal-title fs-6" id="submitThemeLabel"><a href="/themeeditor.html">Theme Editor</a></h1>
        </div>
        <div class="modal-body">
            <label for="themedata" class="form-label">Theme Data</label>
            <input type="text" class="form-control" id="themedata"><br>
            <label for="name" class="form-label">Your Name</label>
            <input type="text" class="form-control" id="name">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="submitTheme()">Submit Theme</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="rules" tabindex="-1" aria-labelledby="rulesLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="rulesLabel">Rules</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <ul>
              <li>Theme Names and Author Names must be school appropriate</li>
              <li>Author Name must be either a nickname/username you go by or your name</li>
              <li>Duplicate themes are not allowed</li>
              <li>Do not try to impersonate me</li>
            </ul>
            <strong><p>Any themes found to be violating these rules will be removed at my discretion.</p></strong>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="adminLogin" tabindex="-1" aria-labelledby="adminLoginLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="adminLoginLabel">Administrator Login</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <label for="username" class="form-label">Username</label>
            <input type="text" class="form-control" id="username"><br>
            <label for="password" class="form-label">Password</label>
            <input type="password" class="form-control" id="password" onkeydown="if(event.keyCode===13 && this.value.trim() !== '') login()">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="login()">Login</button>
        </div>
      </div>
    </div>
  </div>
</html>
<script>
  setTimeout(() => {
    getThemes();
  }, Math.floor(Math.random() * 1000) + 200);


  var allThemes = [];
    function getThemes(){
        fetch("https://classclock-api.reubenschiopu.com/themes/getall")
        .then(response => response.json())
        .then(data => {
          var randomTheme = {
            name: "Install a Random Theme",
            theme_data: "random",
            author: "",
            download_count: "yes"
          }
          data.unshift(randomTheme);
          allThemes = data;
            var cardContainer = document.getElementById("card-container");
            for(var i = 0; i < data.length; i++){
                (function() {
                    var theme = data[i];
                    var themeCard = document.createElement("div");
                    themeCard.onmouseover = function(){
                      themeCard.style.background = JSON.parse(theme.theme_data).cssGradient;
                      themeCard.style.fontFamily = JSON.parse(theme.theme_data).themeFont;
                      themeCard.style.color = JSON.parse(theme.theme_data).fontColor;
                    }
                    themeCard.onmouseout = function(){
                      themeCard.style.background = "";
                      themeCard.style.fontFamily = "";
                      themeCard.style.color = "";
                    }
                    themeCard.classList.add("card");
                    themeCard.classList.add("col-sm-3");
                    var themeCardBody = document.createElement("div");
                    themeCardBody.classList.add("card-body");
                    var themeCardTitle = document.createElement("h5");
                    themeCardTitle.classList.add("card-title");
                    themeCardTitle.innerText = theme.name;
                    var themeCardText = document.createElement("p");
                    themeCardText.classList.add("card-text");
                    var themeCardDownloadCount = document.createElement("p");
                    themeCardDownloadCount.classList.add("card-text");
                    var downloadIconSVG = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cloud-download" viewBox="0 0 16 16">
                      <path d="M4.406 1.342A5.53 5.53 0 0 1 8 0c2.69 0 4.923 2 5.166 4.579C14.758 4.804 16 6.137 16 7.773 16 9.569 14.502 11 12.687 11H10a.5.5 0 0 1 0-1h2.688C13.979 10 15 8.988 15 7.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 2.825 10.328 1 8 1a4.53 4.53 0 0 0-2.941 1.1c-.757.652-1.153 1.438-1.153 2.055v.448l-.445.049C2.064 4.805 1 5.952 1 7.318 1 8.785 2.23 10 3.781 10H6a.5.5 0 0 1 0 1H3.781C1.708 11 0 9.366 0 7.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383"/>
                      <path d="M7.646 15.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 14.293V5.5a.5.5 0 0 0-1 0v8.793l-2.146-2.147a.5.5 0 0 0-.708.708z"/>
                    </svg>`;
                    themeCardDownloadCount.innerHTML = downloadIconSVG + "  " + theme.download_count;
                    themeCardDownloadCount.setAttribute("data-bs-toggle", "tooltip");
                    themeCardDownloadCount.setAttribute("data-bs-title", "Download Count");
                    themeCardDownloadCount.style.width = "25%";
                    if (theme.author == "") {
                        themeCardText.innerText = "";
                    } else{
                      themeCardText.innerText = "Submitted By: " + theme.author;
                    }
                    var themeCardButton = document.createElement("button");
                    themeCardButton.classList.add("btn");
                    themeCardButton.classList.add("btn-primary");
                    themeCardButton.innerText = "Install";
                    themeCardButton.onclick = function(){
                        installTheme(theme.theme_data, theme._id);
                    }
                    if(theme.isFeatured){
                      var star = document.createElement("span");
                      star.innerHTML = '<span data-bs-toggle="tooltip" data-bs-title="Featured Theme" class="material-symbols-outlined">star</span>';
                      star.style.position = "absolute";
                      star.style.top = "5px";
                      star.style.right = "5px";
                      themeCard.appendChild(star);
                    }
                    if(theme.isTrash){
                      var trash = document.createElement("span");
                      trash.innerHTML = '<span data-bs-toggle="tooltip" data-bs-title="Trash Theme" class="material-symbols-outlined">block</span>';
                      trash.style.position = "absolute";
                      trash.style.top = "5px";
                      trash.style.right = "5px";
                      themeCard.appendChild(trash);
                    }
                    if(Cookies.get("admin")){
                      var featureButton = document.createElement("button");
                      featureButton.classList.add("btn");
                      featureButton.classList.add("btn-secondary");
                      if(theme.isFeatured){
                        featureButton.innerText = "Unfeature";
                      } else {
                        featureButton.innerText = "Feature";
                      }
                      featureButton.style.position = "absolute";
                      featureButton.style.bottom = "5px";
                      featureButton.style.right = "5px";
                      featureButton.onclick = function(){
                        alert("featured theme");
                        location.reload();
                      }
                      themeCard.appendChild(featureButton);

                      var trashButton = document.createElement("button");
                      trashButton.classList.add("btn");
                      trashButton.classList.add("btn-secondary");
                      if(theme.isTrash){
                        trashButton.innerText = "Untrash";
                      } else {
                        trashButton.innerText = "Trash";
                      }
                      trashButton.style.position = "absolute";
                      trashButton.style.bottom = "50px";
                      trashButton.style.right = "5px";
                      trashButton.onclick = function(){
                        alert("trashed theme");
                        location.reload();
                      }
                      themeCard.appendChild(trashButton);

                      var deleteButton = document.createElement("button");
                      deleteButton.classList.add("btn");
                      deleteButton.classList.add("btn-danger");
                      deleteButton.innerText = "Delete";
                      deleteButton.style.position = "absolute";
                      deleteButton.style.bottom = "5px";
                      deleteButton.style.right = "90px";
                      deleteButton.onclick = function(){
                        alert("deleted theme");
                        location.reload();
                      }
                      themeCard.appendChild(deleteButton);
                    }
                    themeCardBody.appendChild(themeCardTitle);
                    themeCardBody.appendChild(themeCardText);
                    themeCardBody.appendChild(themeCardDownloadCount);
                    themeCardBody.appendChild(themeCardButton);
                    themeCard.appendChild(themeCardBody);
                    cardContainer.appendChild(themeCard);
                })();
            }

            document.getElementById("loading").style.display = "none";
            const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
            const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
        });
    }

    function submitTheme(){
        var themeData = document.getElementById("themedata").value;
        var name = document.getElementById("name").value;
        if(themeData.length > 200){
          alert("Theme too big!");
          return;
        }
        fetch("https://classclock-api.reubenschiopu.com/themes/submit", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                theme_data: themeData,
                author: name
            })
        });
        $("#submitTheme").modal("hide");
        var submittedThemes = Cookies.get("submitted-themes");
        if(submittedThemes == undefined){
            submittedThemes = [];
        } else {
            submittedThemes = JSON.parse(submittedThemes);
        }
        submittedThemes.push(themeData);
        Cookies.set("submitted-themes", JSON.stringify(submittedThemes), { expires: 30 });
        setTimeout(() => {
            window.location.reload();
        }, 700);
    }

    function deleteTheme(themeData){
        fetch("https://classclock-api.reubenschiopu.com/themes/delete", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                theme_data: themeData
            })
        });
        var submittedThemes = Cookies.get("submitted-themes");
        if(submittedThemes == undefined){
            submittedThemes = [];
        } else {
            submittedThemes = JSON.parse(submittedThemes);
        }
        submittedThemes.splice(submittedThemes.indexOf(themeData), 1);
        Cookies.set("submitted-themes", JSON.stringify(submittedThemes), { expires: 30 });
        setTimeout(() => {
            window.location.reload();
        }, 700);
    }
    
    function installTheme(themeData, id){
      fetch("https://classclock-api.reubenschiopu.com/themes/download", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          id: id
        })
      });
      $("#installingTheme").modal("show");
      var progressBarInterval = setInterval(function(){
          var progressBar = document.querySelector(".progress-bar");
          var currentWidth = parseInt(progressBar.style.width);
          if(currentWidth >= 100){
              clearInterval(progressBarInterval);
              progressBar.classList.add("bg-success");
              Cookies.set("theme", "custom", { expires: 30 });
              Cookies.set("custom-theme", themeData, { expires: 30 });
              if(themeData == "random"){
                var randomTheme = allThemes[Math.floor(Math.random() * allThemes.length)];
                while(randomTheme.themeData == "random"){
                  randomTheme = allThemes[Math.floor(Math.random() * allThemes.length)];
                }
                Cookies.set("custom-theme", randomTheme.theme_data, { expires: 30 });
              }
              setInterval(() => {
                  progressBar.style.width = "0%";
                  $("#installingTheme").modal("hide");
                  document.location.href = "/";
              }, 700);
          } else {
              var randNumber = Math.floor(Math.random() * 30);
              progressBar.style.width = currentWidth + randNumber + "%";
          }
      }, 90);
    }

    function login(){
      Cookies.remove("admin");
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;
      fetch("https://classclock-api.reubenschiopu.com/admin/login", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          username: username,
          password: password
        })
      }).then(response => response.json()).then(data => {
        if(data.success){
          Cookies.set("admin", true, { expires: 5 });
          Cookies.set("admin-username", username, { expires: 5 });
          Cookies.set("admin-password", password, { expires: 5 });
          window.location.reload();
        } else {
          alert("Invalid Credentials");
          location.reload();
        }
        $("#adminLogin").modal("hide");
      });
    }

    function updateTheme(themeName, valueToChange, newValue){
      fetch("https://classclock-api.reubenschiopu.com/admin/update-theme", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          themeName: themeName,
          valueToChange: valueToChange,
          newValue: newValue,
          username: Cookies.get("admin-username"),
          password: Cookies.get("admin-password")
        })
      });
      setTimeout(() => {
        window.location.reload();
      }, 700);
    }
</script>
<style>
    #card-container{
        margin:10px;
        padding:10px;
    }


    #loading{
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        display: flex;
        justify-content: center;
        align-items: center;
    }
     /* Spinner from https://loading.io/css/ */
    .lds-roller,
    .lds-roller div,
    .lds-roller div:after {
      box-sizing: border-box;
    }
    .lds-roller {
      display: inline-block;
      position: relative;
      width: 80px;
      height: 80px;
    }
    .lds-roller div {
      animation: lds-roller 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
      transform-origin: 40px 40px;
    }
    .lds-roller div:after {
      content: " ";
      display: block;
      position: absolute;
      width: 7.2px;
      height: 7.2px;
      border-radius: 50%;
      background: currentColor;
      margin: -3.6px 0 0 -3.6px;
    }
    .lds-roller div:nth-child(1) {
      animation-delay: -0.036s;
    }
    .lds-roller div:nth-child(1):after {
      top: 62.62742px;
      left: 62.62742px;
    }
    .lds-roller div:nth-child(2) {
      animation-delay: -0.072s;
    }
    .lds-roller div:nth-child(2):after {
      top: 67.71281px;
      left: 56px;
    }
    .lds-roller div:nth-child(3) {
      animation-delay: -0.108s;
    }
    .lds-roller div:nth-child(3):after {
      top: 70.90963px;
      left: 48.28221px;
    }
    .lds-roller div:nth-child(4) {
      animation-delay: -0.144s;
    }
    .lds-roller div:nth-child(4):after {
      top: 72px;
      left: 40px;
    }
    .lds-roller div:nth-child(5) {
      animation-delay: -0.18s;
    }
    .lds-roller div:nth-child(5):after {
      top: 70.90963px;
      left: 31.71779px;
    }
    .lds-roller div:nth-child(6) {
      animation-delay: -0.216s;
    }
    .lds-roller div:nth-child(6):after {
      top: 67.71281px;
      left: 24px;
    }
    .lds-roller div:nth-child(7) {
      animation-delay: -0.252s;
    }
    .lds-roller div:nth-child(7):after {
      top: 62.62742px;
      left: 17.37258px;
    }
    .lds-roller div:nth-child(8) {
      animation-delay: -0.288s;
    }
    .lds-roller div:nth-child(8):after {
      top: 56px;
      left: 12.28719px;
    }
    @keyframes lds-roller {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }
</style>